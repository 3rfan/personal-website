---
import { WORK } from '../lib/constants'
import BaseLayout from '../layouts/BaseLayout.astro'
import Container from '../components/Container.astro'
import { Button } from '../components/ui/button'
import { ArrowLeft, MapPin, Calendar, ExternalLink } from 'lucide-react'
import {
  getLangFromUrl,
  useTranslations,
  useTranslatedExperience,
  useTranslatedPath,
} from '../i18n/utils'

import { EXPERIENCE } from '../lib/constants'

const lang = getLangFromUrl(Astro.url)
const t = useTranslations(lang)
const getExperience = useTranslatedExperience(lang)
const translatePath = useTranslatedPath(lang)
---

<BaseLayout title={t('work.title')} description={t('work.description')}>
  <main class="flex min-h-[80vh] flex-auto flex-col py-12" transition:animate="fade">
    <Container size="md">
      <div class="mb-8">
        <a href={translatePath('/')}>
          <Button variant="ghost" size="sm" className="mb-4">
            <ArrowLeft className="mr-2 h-4 w-4" />
            {t('nav.home')}
          </Button>
        </a>
        <h2
          class="scroll-m-20 border-b pb-2 text-3xl font-semibold tracking-tight first:mt-0"
        >
          {t('work.title')}
        </h2>
      </div>
    </Container>
    <div class="py-8">
      <Container size="md">
        <div class="space-y-8">
          {
            EXPERIENCE.map((entry) => {
              const translatedExp = getExperience(entry.id)
              if (!translatedExp) return null
              return (
                <div class="animate rounded-lg border bg-card p-6 shadow-sm transition-shadow hover:shadow-md">
                  <div class="flex flex-col gap-4">
                    {/* Header */}
                    <div class="flex flex-col gap-2">
                      <div class="flex items-start justify-between gap-4">
                        <div class="flex-1">
                          <h3 class="text-xl font-semibold">
                            {translatedExp.position}
                          </h3>
                          <a
                            href={entry.link ?? ''}
                            target="_blank"
                            class="text-primary hover:underline inline-flex items-center gap-1 text-lg font-medium mt-1"
                          >
                            {translatedExp.company}
                            <ExternalLink className="h-4 w-4" />
                          </a>
                        </div>
                        <div class="flex items-center gap-2 text-sm text-muted-foreground bg-secondary px-3 py-1 rounded-full">
                          <Calendar className="h-4 w-4" />
                          <span>
                            {entry.start} - {entry.end === 'Current' ? translatedExp.current : entry.end}
                          </span>
                        </div>
                      </div>
                      <div class="flex items-center gap-2 text-sm text-muted-foreground">
                        <MapPin className="h-4 w-4" />
                        <span>{translatedExp.location}</span>
                      </div>
                    </div>

                    {/* Tasks */}
                    {translatedExp.tasks.length > 0 && (
                      <div class="mt-2">
                        <h4 class="text-sm font-semibold mb-3 text-muted-foreground uppercase tracking-wide">
                          Key Responsibilities:
                        </h4>
                        <ul class="space-y-2">
                          {translatedExp.tasks.map((task) => (
                            <li class="flex gap-2 text-sm leading-relaxed">
                              <span class="text-primary mt-1">â€¢</span>
                              <span>{task}</span>
                            </li>
                          ))}
                        </ul>
                      </div>
                    )}
                  </div>
                </div>
              )
            })
          }
        </div>
      </Container>
    </div>
  </main>
</BaseLayout>
