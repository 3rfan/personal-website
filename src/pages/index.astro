---
import BaseLayout from '../layouts/BaseLayout.astro'
import IntroCard from '../components/sections/IntroCard.astro'
import AboutMe from '../components/sections/AboutMe.astro'
import Card from '../components/Card.astro'
import ContactsCard from '../components/sections/ContactsCard.astro'
import Now from '../components/sections/Now.astro'
import ExperienceCard from '../components/sections/ExperienceCard.astro'
import EducationCard from '../components/sections/EducationCard.astro'
import HobbiesCard from '../components/sections/HobbiesCard.astro'
import TechStackCard from '../components/sections/TechStackCard.astro'
import ArtCard from '../components/sections/ArtCard.astro'
import { NavigationCard } from '../components/sections/NavigationCard'
import {
  getLangFromUrl,
  useTranslations,
  useTranslatedPath,
  getRouteFromUrl,
} from '../i18n/utils'
import { languages } from '../i18n/ui'
import FooterCard from '../components/sections/FooterCard.astro'

const lang = getLangFromUrl(Astro.url)
const t = useTranslations(lang)
const translatePath = useTranslatedPath(lang)
const route = getRouteFromUrl(Astro.url) || ''

// Generate paths for all languages
const languagePaths: Record<string, string> = {}
Object.keys(languages).forEach((l) => {
  languagePaths[l] = translatePath(route ? `/${route}` : '/', l)
})

const navigationTranslations = {
  contacts: t('contacts.title'),
  about: t('about.title'),
  education: t('education.title'),
  experience: t('experience.title'),
  portfolio: t('home.portfolio'),
  techstack: t('techstack.title'),
}

const navigationLabels = {
  theme: t('nav.theme'),
  language: t('nav.language'),
  sections: t('nav.sections'),
}
---

<script>
  import { animate, stagger } from 'motion'

  function initAnimations() {
    const loader = document.querySelector('.loader')
    const cards = document.querySelectorAll('.card-animate')

    if (loader) {
      animate(
        loader,
        { opacity: [1, 0], pointerEvents: 'none' },
        { duration: 0.3, easing: 'ease-out' }
      ).finished.then(() => {
        animateCards(cards)
      })
    } else {
      animateCards(cards)
    }
  }

  function animateCards(cards: NodeListOf<Element>) {
    if (cards.length > 0) {
      animate(
        cards,
        { y: ['40%', '0%'], opacity: [0, 1] },
        {
          duration: 0.4,
          delay: stagger(0.3),
          easing: 'ease-out',
        }
      )
    }
  }

  document.addEventListener('astro:page-load', initAnimations)
</script>

<BaseLayout title={t('home.title')} description={t('home.description')}>
  <div
    slot="loader"
    class="loader bg-darkslate-700 fixed bottom-0 left-0 right-0 top-0 z-50 flex h-screen w-screen items-center justify-center text-3xl font-black uppercase text-neutral-50"
  >
  </div>
  <main
    class="relative m-auto grid w-full max-w-5xl gap-3 overflow-visible p-4 sm:gap-3 sm:p-4 md:grid-cols-4 md:gap-4 md:p-6 lg:grid-cols-5 lg:auto-rows-min lg:gap-4"
  >
    <Card colSpan="md:col-span-1" rowSpan="lg:row-span-2">
      <NavigationCard
        currentLang={lang}
        currentRoute={route}
        languagePaths={languagePaths}
        translations={navigationTranslations}
        labels={navigationLabels}
        client:load
      />
    </Card>
    <IntroCard />
    <!-- <Now /> -->
    <EducationCard />
    <ExperienceCard />
    <Card
      colSpan="md:col-span-1 lg:col-span-1"
      rowSpan="md:row-span-1 lg:row-span-2"
      title={t('home.portfolio')}
      href={translatePath('/portfolio')}
    />
    <AboutMe />
    <!-- <ContactsCard /> -->
    <HobbiesCard />
    <ArtCard />
    <TechStackCard />
    <FooterCard />
  </main>
</BaseLayout>
