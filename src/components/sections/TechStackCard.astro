---
import Card from '../common/Card.astro'
import { TechBadge } from '../common/TechBadge'
import { getLangFromUrl, useTranslations } from '../../i18n/utils'

const lang = getLangFromUrl(Astro.url)
const t = useTranslations(lang)

const technologies = [
  'Java',
  'Python',
  'SQL',
  'TypeScript',
  'React',
  'Node.js',
  'Azure',
  'Git',
  'Docker',
]
---

<Card colSpan="md:col-span-12 lg:col-span-2" rowSpan="lg:row-span-1" title={t('techstack.title')}>
  <p class="mt-2 text-sm text-muted-foreground">{t('techstack.description')}</p>
  <div class="relative mt-4 overflow-hidden">
    <!-- Gradient fade on edges -->
    <div
      class="pointer-events-none absolute left-0 top-0 z-10 h-full w-12 bg-gradient-to-r from-card to-transparent"
    >
    </div>
    <div
      class="pointer-events-none absolute right-0 top-0 z-10 h-full w-12 bg-gradient-to-l from-card to-transparent"
    >
    </div>

    <!-- Scrolling container -->
    <div class="scroll-container flex gap-3 py-2 overflow-x-auto cursor-grab active:cursor-grabbing" id="tech-scroll-container">
      <!-- First set of technologies -->
      <div class="flex shrink-0 animate-scroll gap-3">
        {technologies.map((tech) => <TechBadge name={tech} client:load />)}
      </div>

      <!-- Duplicate set for seamless loop -->
      <div class="flex shrink-0 animate-scroll gap-3">
        {technologies.map((tech) => <TechBadge name={tech} client:load />)}
      </div>

      <!-- Duplicate set for seamless loop -->
      <div class="flex shrink-0 animate-scroll gap-3">
        {technologies.map((tech) => <TechBadge name={tech} client:load />)}
      </div>
    </div>
  </div>
</Card>

<style>
  @keyframes scroll {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-100%);
    }
  }

  .animate-scroll {
    animation: scroll 30s linear infinite;
  }

  .scroll-container:hover .animate-scroll {
    animation-play-state: paused;
  }

  .scroll-container.dragging .animate-scroll {
    animation: none !important;
    transform: translateX(0) !important;
  }

  .scroll-container {
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  .scroll-container::-webkit-scrollbar {
    display: none;
  }
</style>

<script>
  function initDragScroll() {
    const container = document.getElementById('tech-scroll-container')
    if (!container) return

    let isDown = false
    let startX: number
    let scrollLeft: number

    container.addEventListener('mousedown', (e) => {
      isDown = true
      container.classList.add('dragging')
      startX = e.pageX - container.offsetLeft
      scrollLeft = container.scrollLeft
    })

    container.addEventListener('mouseleave', () => {
      isDown = false
      container.classList.remove('dragging')
    })

    container.addEventListener('mouseup', () => {
      isDown = false
      container.classList.remove('dragging')
    })

    container.addEventListener('mousemove', (e) => {
      if (!isDown) return
      e.preventDefault()
      const x = e.pageX - container.offsetLeft
      const walk = (x - startX) * 2 // Scroll speed multiplier
      container.scrollLeft = scrollLeft - walk
    })

    // Touch events for mobile
    let touchStartX: number
    let touchScrollLeft: number

    container.addEventListener('touchstart', (e) => {
      container.classList.add('dragging')
      touchStartX = e.touches[0].pageX - container.offsetLeft
      touchScrollLeft = container.scrollLeft
    })

    container.addEventListener('touchmove', (e) => {
      const x = e.touches[0].pageX - container.offsetLeft
      const walk = (x - touchStartX) * 2
      container.scrollLeft = touchScrollLeft - walk
    })

    container.addEventListener('touchend', () => {
      container.classList.remove('dragging')
    })
  }

  // Initialize on page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initDragScroll)
  } else {
    initDragScroll()
  }

  // Re-initialize on Astro page transitions
  document.addEventListener('astro:page-load', initDragScroll)
</script>
